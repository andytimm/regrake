% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/construct_admm_inputs.R
\name{construct_admm_inputs}
\alias{construct_admm_inputs}
\title{Construct inputs for ADMM solver}
\usage{
construct_admm_inputs(data, formula_spec, target_values, normalize = TRUE)
}
\arguments{
\item{data}{Data frame containing sample data. Character columns will be
automatically converted to factors.}

\item{formula_spec}{A list containing the parsed formula specification from
\code{parse_raking_formula}, with components:
\itemize{
\item \code{formula}: The model formula
\item \code{terms}: List of term specifications, each containing:
\itemize{
\item \code{type}: Term type ("exact", "l2", "kl", "var", "quantile", or "range")
\item \code{variables}: Variable names
\item \code{interaction}: List of variable expressions (NULL for main effects)
}
}}

\item{target_values}{List containing target values computed from population data,
with components:
\itemize{
\item \code{targets}: Named list of target values for each term
}}

\item{normalize}{Logical. If TRUE, continuous variables are scaled by their
target value for numerical stability.}
}
\value{
A list containing:
\itemize{
\item \code{design_matrix}: A sparse Matrix (class "dgCMatrix") where each row
represents a constraint and each column represents a sample. For factor
variables, each level gets a row. For interactions, each combination of
levels gets a row.
\item \code{losses}: A list of loss functions, one per term. Each loss
contains:
\itemize{
\item \code{fn}: The loss function
\item \code{target}: Target values for this term
\item \code{prox}: The proximal operator for this loss
}
}
}
\description{
Builds the design matrix and loss functions needed by the ADMM solver.
This function takes parsed formula specifications and target values to create
a sparse design matrix and corresponding loss functions for optimization.

The design matrix is constructed as a sparse indicator matrix where:
\itemize{
\item Each row represents a constraint (level of a factor or interaction)
\item Each column represents a sample
\item Matrix entries are 1 where a sample belongs to a level, 0 otherwise
}

For interactions, the function creates rows for each unique combination of levels.
}
\details{
The function performs several key steps:
\enumerate{
\item Converts character columns to factors
\item Creates model matrices for each term
\item Converts to sparse format for efficiency
\item Assigns appropriate loss functions based on term type
}

For sparse matrix operations, the function uses the Matrix package's dgCMatrix
format. Column sums of the design matrix should equal 1 for each sample,
indicating that each sample belongs to exactly one level of each factor.
}
\keyword{internal}
